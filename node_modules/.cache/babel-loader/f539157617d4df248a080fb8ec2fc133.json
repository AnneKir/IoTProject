{"ast":null,"code":"import { __read, __spreadArray } from \"tslib\";\nimport { innerFrom } from '../observable/innerFrom';\nimport { Subject } from '../Subject';\nimport { SafeSubscriber } from '../Subscriber';\nimport { operate } from '../util/lift';\nexport function share(options) {\n  if (options === void 0) {\n    options = {};\n  }\n  var _a = options.connector,\n    connector = _a === void 0 ? function () {\n      return new Subject();\n    } : _a,\n    _b = options.resetOnError,\n    resetOnError = _b === void 0 ? true : _b,\n    _c = options.resetOnComplete,\n    resetOnComplete = _c === void 0 ? true : _c,\n    _d = options.resetOnRefCountZero,\n    resetOnRefCountZero = _d === void 0 ? true : _d;\n  return function (wrapperSource) {\n    var connection;\n    var resetConnection;\n    var subject;\n    var refCount = 0;\n    var hasCompleted = false;\n    var hasErrored = false;\n    var cancelReset = function () {\n      resetConnection === null || resetConnection === void 0 ? void 0 : resetConnection.unsubscribe();\n      resetConnection = undefined;\n    };\n    var reset = function () {\n      cancelReset();\n      connection = subject = undefined;\n      hasCompleted = hasErrored = false;\n    };\n    var resetAndUnsubscribe = function () {\n      var conn = connection;\n      reset();\n      conn === null || conn === void 0 ? void 0 : conn.unsubscribe();\n    };\n    return operate(function (source, subscriber) {\n      refCount++;\n      if (!hasErrored && !hasCompleted) {\n        cancelReset();\n      }\n      var dest = subject = subject !== null && subject !== void 0 ? subject : connector();\n      subscriber.add(function () {\n        refCount--;\n        if (refCount === 0 && !hasErrored && !hasCompleted) {\n          resetConnection = handleReset(resetAndUnsubscribe, resetOnRefCountZero);\n        }\n      });\n      dest.subscribe(subscriber);\n      if (!connection && refCount > 0) {\n        connection = new SafeSubscriber({\n          next: function (value) {\n            return dest.next(value);\n          },\n          error: function (err) {\n            hasErrored = true;\n            cancelReset();\n            resetConnection = handleReset(reset, resetOnError, err);\n            dest.error(err);\n          },\n          complete: function () {\n            hasCompleted = true;\n            cancelReset();\n            resetConnection = handleReset(reset, resetOnComplete);\n            dest.complete();\n          }\n        });\n        innerFrom(source).subscribe(connection);\n      }\n    })(wrapperSource);\n  };\n}\nfunction handleReset(reset, on) {\n  var args = [];\n  for (var _i = 2; _i < arguments.length; _i++) {\n    args[_i - 2] = arguments[_i];\n  }\n  if (on === true) {\n    reset();\n    return;\n  }\n  if (on === false) {\n    return;\n  }\n  var onSubscriber = new SafeSubscriber({\n    next: function () {\n      onSubscriber.unsubscribe();\n      reset();\n    }\n  });\n  return on.apply(void 0, __spreadArray([], __read(args))).subscribe(onSubscriber);\n}","map":{"version":3,"mappings":"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","names":["innerFrom","Subject","SafeSubscriber","operate","share","options","connector","_b","resetOnError","_c","resetOnComplete","_d","resetOnRefCountZero","wrapperSource","connection","resetConnection","subject","refCount","hasCompleted","hasErrored","cancelReset","unsubscribe","undefined","reset","resetAndUnsubscribe","conn","source","subscriber","dest","add","handleReset","subscribe","next","value","error","err","complete","on","_i","args","onSubscriber"],"sources":["../../../../src/internal/operators/share.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"module"}