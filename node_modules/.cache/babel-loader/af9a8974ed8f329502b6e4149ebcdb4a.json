{"ast":null,"code":"import { operate } from '../util/lift';\nimport { createOperatorSubscriber } from './OperatorSubscriber';\nexport function refCount() {\n  return operate(function (source, subscriber) {\n    var connection = null;\n    source._refCount++;\n    var refCounter = createOperatorSubscriber(subscriber, undefined, undefined, undefined, function () {\n      if (!source || source._refCount <= 0 || 0 < --source._refCount) {\n        connection = null;\n        return;\n      }\n      var sharedConnection = source._connection;\n      var conn = connection;\n      connection = null;\n      if (sharedConnection && (!conn || sharedConnection === conn)) {\n        sharedConnection.unsubscribe();\n      }\n      subscriber.unsubscribe();\n    });\n    source.subscribe(refCounter);\n    if (!refCounter.closed) {\n      connection = source.connect();\n    }\n  });\n}","map":{"version":3,"mappings":"AAGA,SAASA,OAAO,QAAQ,cAAc;AACtC,SAASC,wBAAwB,QAAQ,sBAAsB;AA4D/D,OAAM,SAAUC,QAAQ;EACtB,OAAOF,OAAO,CAAC,UAACG,MAAM,EAAEC,UAAU;IAChC,IAAIC,UAAU,GAAwB,IAAI;IAEzCF,MAAc,CAACG,SAAS,EAAE;IAE3B,IAAMC,UAAU,GAAGN,wBAAwB,CAACG,UAAU,EAAEI,SAAS,EAAEA,SAAS,EAAEA,SAAS,EAAE;MACvF,IAAI,CAACL,MAAM,IAAKA,MAAc,CAACG,SAAS,IAAI,CAAC,IAAI,CAAC,GAAG,EAAGH,MAAc,CAACG,SAAS,EAAE;QAChFD,UAAU,GAAG,IAAI;QACjB;;MA4BF,IAAMI,gBAAgB,GAAIN,MAAc,CAACO,WAAW;MACpD,IAAMC,IAAI,GAAGN,UAAU;MACvBA,UAAU,GAAG,IAAI;MAEjB,IAAII,gBAAgB,KAAK,CAACE,IAAI,IAAIF,gBAAgB,KAAKE,IAAI,CAAC,EAAE;QAC5DF,gBAAgB,CAACG,WAAW,EAAE;;MAGhCR,UAAU,CAACQ,WAAW,EAAE;IAC1B,CAAC,CAAC;IAEFT,MAAM,CAACU,SAAS,CAACN,UAAU,CAAC;IAE5B,IAAI,CAACA,UAAU,CAACO,MAAM,EAAE;MACtBT,UAAU,GAAIF,MAAmC,CAACY,OAAO,EAAE;;EAE/D,CAAC,CAAC;AACJ","names":["operate","createOperatorSubscriber","refCount","source","subscriber","connection","_refCount","refCounter","undefined","sharedConnection","_connection","conn","unsubscribe","subscribe","closed","connect"],"sources":["../../../../src/internal/operators/refCount.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"module"}