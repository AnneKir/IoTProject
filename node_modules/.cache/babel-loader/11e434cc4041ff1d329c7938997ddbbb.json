{"ast":null,"code":"'use strict';\n\n/**\n * Module dependencies\n */\nconst xtend = require('xtend');\nconst Readable = require('readable-stream').Readable;\nconst streamsOpts = {\n  objectMode: true\n};\nconst defaultStoreOptions = {\n  clean: true\n};\n\n/**\n * In-memory implementation of the message store\n * This can actually be saved into files.\n *\n * @param {Object} [options] - store options\n */\nfunction Store(options) {\n  if (!(this instanceof Store)) {\n    return new Store(options);\n  }\n  this.options = options || {};\n\n  // Defaults\n  this.options = xtend(defaultStoreOptions, options);\n  this._inflights = new Map();\n}\n\n/**\n * Adds a packet to the store, a packet is\n * anything that has a messageId property.\n *\n */\nStore.prototype.put = function (packet, cb) {\n  this._inflights.set(packet.messageId, packet);\n  if (cb) {\n    cb();\n  }\n  return this;\n};\n\n/**\n * Creates a stream with all the packets in the store\n *\n */\nStore.prototype.createStream = function () {\n  const stream = new Readable(streamsOpts);\n  const values = [];\n  let destroyed = false;\n  let i = 0;\n  this._inflights.forEach(function (value, key) {\n    values.push(value);\n  });\n  stream._read = function () {\n    if (!destroyed && i < values.length) {\n      this.push(values[i++]);\n    } else {\n      this.push(null);\n    }\n  };\n  stream.destroy = function () {\n    if (destroyed) {\n      return;\n    }\n    const self = this;\n    destroyed = true;\n    setTimeout(function () {\n      self.emit('close');\n    }, 0);\n  };\n  return stream;\n};\n\n/**\n * deletes a packet from the store.\n */\nStore.prototype.del = function (packet, cb) {\n  packet = this._inflights.get(packet.messageId);\n  if (packet) {\n    this._inflights.delete(packet.messageId);\n    cb(null, packet);\n  } else if (cb) {\n    cb(new Error('missing packet'));\n  }\n  return this;\n};\n\n/**\n * get a packet from the store.\n */\nStore.prototype.get = function (packet, cb) {\n  packet = this._inflights.get(packet.messageId);\n  if (packet) {\n    cb(null, packet);\n  } else if (cb) {\n    cb(new Error('missing packet'));\n  }\n  return this;\n};\n\n/**\n * Close the store\n */\nStore.prototype.close = function (cb) {\n  if (this.options.clean) {\n    this._inflights = null;\n  }\n  if (cb) {\n    cb();\n  }\n};\nmodule.exports = Store;","map":{"version":3,"names":["xtend","require","Readable","streamsOpts","objectMode","defaultStoreOptions","clean","Store","options","_inflights","Map","prototype","put","packet","cb","set","messageId","createStream","stream","values","destroyed","i","forEach","value","key","push","_read","length","destroy","self","setTimeout","emit","del","get","delete","Error","close","module","exports"],"sources":["C:/Users/Amali/Desktop/Building_the_IoT_w._P2P_and_Cloud_Computing/IoTProject/node_modules/mqtt/lib/store.js"],"sourcesContent":["'use strict'\n\n/**\n * Module dependencies\n */\nconst xtend = require('xtend')\n\nconst Readable = require('readable-stream').Readable\nconst streamsOpts = { objectMode: true }\nconst defaultStoreOptions = {\n  clean: true\n}\n\n/**\n * In-memory implementation of the message store\n * This can actually be saved into files.\n *\n * @param {Object} [options] - store options\n */\nfunction Store (options) {\n  if (!(this instanceof Store)) {\n    return new Store(options)\n  }\n\n  this.options = options || {}\n\n  // Defaults\n  this.options = xtend(defaultStoreOptions, options)\n\n  this._inflights = new Map()\n}\n\n/**\n * Adds a packet to the store, a packet is\n * anything that has a messageId property.\n *\n */\nStore.prototype.put = function (packet, cb) {\n  this._inflights.set(packet.messageId, packet)\n\n  if (cb) {\n    cb()\n  }\n\n  return this\n}\n\n/**\n * Creates a stream with all the packets in the store\n *\n */\nStore.prototype.createStream = function () {\n  const stream = new Readable(streamsOpts)\n  const values = []\n  let destroyed = false\n  let i = 0\n\n  this._inflights.forEach(function (value, key) {\n    values.push(value)\n  })\n\n  stream._read = function () {\n    if (!destroyed && i < values.length) {\n      this.push(values[i++])\n    } else {\n      this.push(null)\n    }\n  }\n\n  stream.destroy = function () {\n    if (destroyed) {\n      return\n    }\n\n    const self = this\n\n    destroyed = true\n\n    setTimeout(function () {\n      self.emit('close')\n    }, 0)\n  }\n\n  return stream\n}\n\n/**\n * deletes a packet from the store.\n */\nStore.prototype.del = function (packet, cb) {\n  packet = this._inflights.get(packet.messageId)\n  if (packet) {\n    this._inflights.delete(packet.messageId)\n    cb(null, packet)\n  } else if (cb) {\n    cb(new Error('missing packet'))\n  }\n\n  return this\n}\n\n/**\n * get a packet from the store.\n */\nStore.prototype.get = function (packet, cb) {\n  packet = this._inflights.get(packet.messageId)\n  if (packet) {\n    cb(null, packet)\n  } else if (cb) {\n    cb(new Error('missing packet'))\n  }\n\n  return this\n}\n\n/**\n * Close the store\n */\nStore.prototype.close = function (cb) {\n  if (this.options.clean) {\n    this._inflights = null\n  }\n  if (cb) {\n    cb()\n  }\n}\n\nmodule.exports = Store\n"],"mappings":"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"},"metadata":{},"sourceType":"script"}