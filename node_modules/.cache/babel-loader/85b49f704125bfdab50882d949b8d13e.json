{"ast":null,"code":"const writeToStream = require('./writeToStream');\nconst EventEmitter = require('events');\nfunction generate(packet, opts) {\n  const stream = new Accumulator();\n  writeToStream(packet, stream, opts);\n  return stream.concat();\n}\nclass Accumulator extends EventEmitter {\n  constructor() {\n    super();\n    this._array = new Array(20);\n    this._i = 0;\n  }\n  write(chunk) {\n    this._array[this._i++] = chunk;\n    return true;\n  }\n  concat() {\n    let length = 0;\n    const lengths = new Array(this._array.length);\n    const list = this._array;\n    let pos = 0;\n    let i;\n    for (i = 0; i < list.length && list[i] !== undefined; i++) {\n      if (typeof list[i] !== 'string') lengths[i] = list[i].length;else lengths[i] = Buffer.byteLength(list[i]);\n      length += lengths[i];\n    }\n    const result = Buffer.allocUnsafe(length);\n    for (i = 0; i < list.length && list[i] !== undefined; i++) {\n      if (typeof list[i] !== 'string') {\n        list[i].copy(result, pos);\n        pos += lengths[i];\n      } else {\n        result.write(list[i], pos);\n        pos += lengths[i];\n      }\n    }\n    return result;\n  }\n}\nmodule.exports = generate;","map":{"version":3,"names":["writeToStream","require","EventEmitter","generate","packet","opts","stream","Accumulator","concat","constructor","_array","Array","_i","write","chunk","length","lengths","list","pos","i","undefined","Buffer","byteLength","result","allocUnsafe","copy","module","exports"],"sources":["/Users/athallenberg/Dropbox/Kandidat/IoT/IoTProject/node_modules/mqtt-packet/generate.js"],"sourcesContent":["const writeToStream = require('./writeToStream')\nconst EventEmitter = require('events')\n\nfunction generate (packet, opts) {\n  const stream = new Accumulator()\n  writeToStream(packet, stream, opts)\n  return stream.concat()\n}\n\nclass Accumulator extends EventEmitter {\n  constructor () {\n    super()\n    this._array = new Array(20)\n    this._i = 0\n  }\n\n  write (chunk) {\n    this._array[this._i++] = chunk\n    return true\n  }\n\n  concat () {\n    let length = 0\n    const lengths = new Array(this._array.length)\n    const list = this._array\n    let pos = 0\n    let i\n\n    for (i = 0; i < list.length && list[i] !== undefined; i++) {\n      if (typeof list[i] !== 'string') lengths[i] = list[i].length\n      else lengths[i] = Buffer.byteLength(list[i])\n\n      length += lengths[i]\n    }\n\n    const result = Buffer.allocUnsafe(length)\n\n    for (i = 0; i < list.length && list[i] !== undefined; i++) {\n      if (typeof list[i] !== 'string') {\n        list[i].copy(result, pos)\n        pos += lengths[i]\n      } else {\n        result.write(list[i], pos)\n        pos += lengths[i]\n      }\n    }\n\n    return result\n  }\n}\n\nmodule.exports = generate\n"],"mappings":"AAAA,MAAMA,aAAa,GAAGC,OAAO,CAAC,iBAAiB,CAAC;AAChD,MAAMC,YAAY,GAAGD,OAAO,CAAC,QAAQ,CAAC;AAEtC,SAASE,QAAQ,CAAEC,MAAM,EAAEC,IAAI,EAAE;EAC/B,MAAMC,MAAM,GAAG,IAAIC,WAAW,EAAE;EAChCP,aAAa,CAACI,MAAM,EAAEE,MAAM,EAAED,IAAI,CAAC;EACnC,OAAOC,MAAM,CAACE,MAAM,EAAE;AACxB;AAEA,MAAMD,WAAW,SAASL,YAAY,CAAC;EACrCO,WAAW,GAAI;IACb,KAAK,EAAE;IACP,IAAI,CAACC,MAAM,GAAG,IAAIC,KAAK,CAAC,EAAE,CAAC;IAC3B,IAAI,CAACC,EAAE,GAAG,CAAC;EACb;EAEAC,KAAK,CAAEC,KAAK,EAAE;IACZ,IAAI,CAACJ,MAAM,CAAC,IAAI,CAACE,EAAE,EAAE,CAAC,GAAGE,KAAK;IAC9B,OAAO,IAAI;EACb;EAEAN,MAAM,GAAI;IACR,IAAIO,MAAM,GAAG,CAAC;IACd,MAAMC,OAAO,GAAG,IAAIL,KAAK,CAAC,IAAI,CAACD,MAAM,CAACK,MAAM,CAAC;IAC7C,MAAME,IAAI,GAAG,IAAI,CAACP,MAAM;IACxB,IAAIQ,GAAG,GAAG,CAAC;IACX,IAAIC,CAAC;IAEL,KAAKA,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGF,IAAI,CAACF,MAAM,IAAIE,IAAI,CAACE,CAAC,CAAC,KAAKC,SAAS,EAAED,CAAC,EAAE,EAAE;MACzD,IAAI,OAAOF,IAAI,CAACE,CAAC,CAAC,KAAK,QAAQ,EAAEH,OAAO,CAACG,CAAC,CAAC,GAAGF,IAAI,CAACE,CAAC,CAAC,CAACJ,MAAM,MACvDC,OAAO,CAACG,CAAC,CAAC,GAAGE,MAAM,CAACC,UAAU,CAACL,IAAI,CAACE,CAAC,CAAC,CAAC;MAE5CJ,MAAM,IAAIC,OAAO,CAACG,CAAC,CAAC;IACtB;IAEA,MAAMI,MAAM,GAAGF,MAAM,CAACG,WAAW,CAACT,MAAM,CAAC;IAEzC,KAAKI,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGF,IAAI,CAACF,MAAM,IAAIE,IAAI,CAACE,CAAC,CAAC,KAAKC,SAAS,EAAED,CAAC,EAAE,EAAE;MACzD,IAAI,OAAOF,IAAI,CAACE,CAAC,CAAC,KAAK,QAAQ,EAAE;QAC/BF,IAAI,CAACE,CAAC,CAAC,CAACM,IAAI,CAACF,MAAM,EAAEL,GAAG,CAAC;QACzBA,GAAG,IAAIF,OAAO,CAACG,CAAC,CAAC;MACnB,CAAC,MAAM;QACLI,MAAM,CAACV,KAAK,CAACI,IAAI,CAACE,CAAC,CAAC,EAAED,GAAG,CAAC;QAC1BA,GAAG,IAAIF,OAAO,CAACG,CAAC,CAAC;MACnB;IACF;IAEA,OAAOI,MAAM;EACf;AACF;AAEAG,MAAM,CAACC,OAAO,GAAGxB,QAAQ"},"metadata":{},"sourceType":"script"}