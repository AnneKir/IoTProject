{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.reconstructPacket = exports.deconstructPacket = void 0;\nvar is_binary_js_1 = require(\"./is-binary.js\");\n/**\n * Replaces every Buffer | ArrayBuffer | Blob | File in packet with a numbered placeholder.\n *\n * @param {Object} packet - socket.io event packet\n * @return {Object} with deconstructed packet and list of buffers\n * @public\n */\nfunction deconstructPacket(packet) {\n  var buffers = [];\n  var packetData = packet.data;\n  var pack = packet;\n  pack.data = _deconstructPacket(packetData, buffers);\n  pack.attachments = buffers.length; // number of binary 'attachments'\n  return {\n    packet: pack,\n    buffers: buffers\n  };\n}\nexports.deconstructPacket = deconstructPacket;\nfunction _deconstructPacket(data, buffers) {\n  if (!data) return data;\n  if (is_binary_js_1.isBinary(data)) {\n    var placeholder = {\n      _placeholder: true,\n      num: buffers.length\n    };\n    buffers.push(data);\n    return placeholder;\n  } else if (Array.isArray(data)) {\n    var newData = new Array(data.length);\n    for (var i = 0; i < data.length; i++) {\n      newData[i] = _deconstructPacket(data[i], buffers);\n    }\n    return newData;\n  } else if (typeof data === \"object\" && !(data instanceof Date)) {\n    var _newData = {};\n    for (var key in data) {\n      if (Object.prototype.hasOwnProperty.call(data, key)) {\n        _newData[key] = _deconstructPacket(data[key], buffers);\n      }\n    }\n    return _newData;\n  }\n  return data;\n}\n/**\n * Reconstructs a binary packet from its placeholder packet and buffers\n *\n * @param {Object} packet - event packet with placeholders\n * @param {Array} buffers - binary buffers to put in placeholder positions\n * @return {Object} reconstructed packet\n * @public\n */\nfunction reconstructPacket(packet, buffers) {\n  packet.data = _reconstructPacket(packet.data, buffers);\n  packet.attachments = undefined; // no longer useful\n  return packet;\n}\nexports.reconstructPacket = reconstructPacket;\nfunction _reconstructPacket(data, buffers) {\n  if (!data) return data;\n  if (data && data._placeholder === true) {\n    var isIndexValid = typeof data.num === \"number\" && data.num >= 0 && data.num < buffers.length;\n    if (isIndexValid) {\n      return buffers[data.num]; // appropriate buffer (should be natural order anyway)\n    } else {\n      throw new Error(\"illegal attachments\");\n    }\n  } else if (Array.isArray(data)) {\n    for (var i = 0; i < data.length; i++) {\n      data[i] = _reconstructPacket(data[i], buffers);\n    }\n  } else if (typeof data === \"object\") {\n    for (var key in data) {\n      if (Object.prototype.hasOwnProperty.call(data, key)) {\n        data[key] = _reconstructPacket(data[key], buffers);\n      }\n    }\n  }\n  return data;\n}","map":{"version":3,"names":["Object","defineProperty","exports","value","reconstructPacket","deconstructPacket","is_binary_js_1","require","packet","buffers","packetData","data","pack","_deconstructPacket","attachments","length","isBinary","placeholder","_placeholder","num","push","Array","isArray","newData","i","Date","key","prototype","hasOwnProperty","call","_reconstructPacket","undefined","isIndexValid","Error"],"sources":["C:/Users/Amali/Desktop/Building_the_IoT_w._P2P_and_Cloud_Computing/IoTProject/node_modules/socket.io-parser/build/cjs/binary.js"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.reconstructPacket = exports.deconstructPacket = void 0;\nconst is_binary_js_1 = require(\"./is-binary.js\");\n/**\n * Replaces every Buffer | ArrayBuffer | Blob | File in packet with a numbered placeholder.\n *\n * @param {Object} packet - socket.io event packet\n * @return {Object} with deconstructed packet and list of buffers\n * @public\n */\nfunction deconstructPacket(packet) {\n    const buffers = [];\n    const packetData = packet.data;\n    const pack = packet;\n    pack.data = _deconstructPacket(packetData, buffers);\n    pack.attachments = buffers.length; // number of binary 'attachments'\n    return { packet: pack, buffers: buffers };\n}\nexports.deconstructPacket = deconstructPacket;\nfunction _deconstructPacket(data, buffers) {\n    if (!data)\n        return data;\n    if (is_binary_js_1.isBinary(data)) {\n        const placeholder = { _placeholder: true, num: buffers.length };\n        buffers.push(data);\n        return placeholder;\n    }\n    else if (Array.isArray(data)) {\n        const newData = new Array(data.length);\n        for (let i = 0; i < data.length; i++) {\n            newData[i] = _deconstructPacket(data[i], buffers);\n        }\n        return newData;\n    }\n    else if (typeof data === \"object\" && !(data instanceof Date)) {\n        const newData = {};\n        for (const key in data) {\n            if (Object.prototype.hasOwnProperty.call(data, key)) {\n                newData[key] = _deconstructPacket(data[key], buffers);\n            }\n        }\n        return newData;\n    }\n    return data;\n}\n/**\n * Reconstructs a binary packet from its placeholder packet and buffers\n *\n * @param {Object} packet - event packet with placeholders\n * @param {Array} buffers - binary buffers to put in placeholder positions\n * @return {Object} reconstructed packet\n * @public\n */\nfunction reconstructPacket(packet, buffers) {\n    packet.data = _reconstructPacket(packet.data, buffers);\n    packet.attachments = undefined; // no longer useful\n    return packet;\n}\nexports.reconstructPacket = reconstructPacket;\nfunction _reconstructPacket(data, buffers) {\n    if (!data)\n        return data;\n    if (data && data._placeholder === true) {\n        const isIndexValid = typeof data.num === \"number\" &&\n            data.num >= 0 &&\n            data.num < buffers.length;\n        if (isIndexValid) {\n            return buffers[data.num]; // appropriate buffer (should be natural order anyway)\n        }\n        else {\n            throw new Error(\"illegal attachments\");\n        }\n    }\n    else if (Array.isArray(data)) {\n        for (let i = 0; i < data.length; i++) {\n            data[i] = _reconstructPacket(data[i], buffers);\n        }\n    }\n    else if (typeof data === \"object\") {\n        for (const key in data) {\n            if (Object.prototype.hasOwnProperty.call(data, key)) {\n                data[key] = _reconstructPacket(data[key], buffers);\n            }\n        }\n    }\n    return data;\n}\n"],"mappings":"AAAA,YAAY;;AACZA,MAAM,CAACC,cAAc,CAACC,OAAO,EAAE,YAAY,EAAE;EAAEC,KAAK,EAAE;AAAK,CAAC,CAAC;AAC7DD,OAAO,CAACE,iBAAiB,GAAGF,OAAO,CAACG,iBAAiB,GAAG,KAAK,CAAC;AAC9D,IAAMC,cAAc,GAAGC,OAAO,CAAC,gBAAgB,CAAC;AAChD;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAASF,iBAAiB,CAACG,MAAM,EAAE;EAC/B,IAAMC,OAAO,GAAG,EAAE;EAClB,IAAMC,UAAU,GAAGF,MAAM,CAACG,IAAI;EAC9B,IAAMC,IAAI,GAAGJ,MAAM;EACnBI,IAAI,CAACD,IAAI,GAAGE,kBAAkB,CAACH,UAAU,EAAED,OAAO,CAAC;EACnDG,IAAI,CAACE,WAAW,GAAGL,OAAO,CAACM,MAAM,CAAC,CAAC;EACnC,OAAO;IAAEP,MAAM,EAAEI,IAAI;IAAEH,OAAO,EAAEA;EAAQ,CAAC;AAC7C;AACAP,OAAO,CAACG,iBAAiB,GAAGA,iBAAiB;AAC7C,SAASQ,kBAAkB,CAACF,IAAI,EAAEF,OAAO,EAAE;EACvC,IAAI,CAACE,IAAI,EACL,OAAOA,IAAI;EACf,IAAIL,cAAc,CAACU,QAAQ,CAACL,IAAI,CAAC,EAAE;IAC/B,IAAMM,WAAW,GAAG;MAAEC,YAAY,EAAE,IAAI;MAAEC,GAAG,EAAEV,OAAO,CAACM;IAAO,CAAC;IAC/DN,OAAO,CAACW,IAAI,CAACT,IAAI,CAAC;IAClB,OAAOM,WAAW;EACtB,CAAC,MACI,IAAII,KAAK,CAACC,OAAO,CAACX,IAAI,CAAC,EAAE;IAC1B,IAAMY,OAAO,GAAG,IAAIF,KAAK,CAACV,IAAI,CAACI,MAAM,CAAC;IACtC,KAAK,IAAIS,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGb,IAAI,CAACI,MAAM,EAAES,CAAC,EAAE,EAAE;MAClCD,OAAO,CAACC,CAAC,CAAC,GAAGX,kBAAkB,CAACF,IAAI,CAACa,CAAC,CAAC,EAAEf,OAAO,CAAC;IACrD;IACA,OAAOc,OAAO;EAClB,CAAC,MACI,IAAI,OAAOZ,IAAI,KAAK,QAAQ,IAAI,EAAEA,IAAI,YAAYc,IAAI,CAAC,EAAE;IAC1D,IAAMF,QAAO,GAAG,CAAC,CAAC;IAClB,KAAK,IAAMG,GAAG,IAAIf,IAAI,EAAE;MACpB,IAAIX,MAAM,CAAC2B,SAAS,CAACC,cAAc,CAACC,IAAI,CAAClB,IAAI,EAAEe,GAAG,CAAC,EAAE;QACjDH,QAAO,CAACG,GAAG,CAAC,GAAGb,kBAAkB,CAACF,IAAI,CAACe,GAAG,CAAC,EAAEjB,OAAO,CAAC;MACzD;IACJ;IACA,OAAOc,QAAO;EAClB;EACA,OAAOZ,IAAI;AACf;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAASP,iBAAiB,CAACI,MAAM,EAAEC,OAAO,EAAE;EACxCD,MAAM,CAACG,IAAI,GAAGmB,kBAAkB,CAACtB,MAAM,CAACG,IAAI,EAAEF,OAAO,CAAC;EACtDD,MAAM,CAACM,WAAW,GAAGiB,SAAS,CAAC,CAAC;EAChC,OAAOvB,MAAM;AACjB;AACAN,OAAO,CAACE,iBAAiB,GAAGA,iBAAiB;AAC7C,SAAS0B,kBAAkB,CAACnB,IAAI,EAAEF,OAAO,EAAE;EACvC,IAAI,CAACE,IAAI,EACL,OAAOA,IAAI;EACf,IAAIA,IAAI,IAAIA,IAAI,CAACO,YAAY,KAAK,IAAI,EAAE;IACpC,IAAMc,YAAY,GAAG,OAAOrB,IAAI,CAACQ,GAAG,KAAK,QAAQ,IAC7CR,IAAI,CAACQ,GAAG,IAAI,CAAC,IACbR,IAAI,CAACQ,GAAG,GAAGV,OAAO,CAACM,MAAM;IAC7B,IAAIiB,YAAY,EAAE;MACd,OAAOvB,OAAO,CAACE,IAAI,CAACQ,GAAG,CAAC,CAAC,CAAC;IAC9B,CAAC,MACI;MACD,MAAM,IAAIc,KAAK,CAAC,qBAAqB,CAAC;IAC1C;EACJ,CAAC,MACI,IAAIZ,KAAK,CAACC,OAAO,CAACX,IAAI,CAAC,EAAE;IAC1B,KAAK,IAAIa,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGb,IAAI,CAACI,MAAM,EAAES,CAAC,EAAE,EAAE;MAClCb,IAAI,CAACa,CAAC,CAAC,GAAGM,kBAAkB,CAACnB,IAAI,CAACa,CAAC,CAAC,EAAEf,OAAO,CAAC;IAClD;EACJ,CAAC,MACI,IAAI,OAAOE,IAAI,KAAK,QAAQ,EAAE;IAC/B,KAAK,IAAMe,GAAG,IAAIf,IAAI,EAAE;MACpB,IAAIX,MAAM,CAAC2B,SAAS,CAACC,cAAc,CAACC,IAAI,CAAClB,IAAI,EAAEe,GAAG,CAAC,EAAE;QACjDf,IAAI,CAACe,GAAG,CAAC,GAAGI,kBAAkB,CAACnB,IAAI,CAACe,GAAG,CAAC,EAAEjB,OAAO,CAAC;MACtD;IACJ;EACJ;EACA,OAAOE,IAAI;AACf"},"metadata":{},"sourceType":"script"}